<div id="this-carousel-id" class="carousel slide">
  <div class="carousel-inner">
    <% @poll.items.each_with_index do |item, index| %>
      <% if index == 0 %>
        <div class="item active">
      <% else %>
        <div class="item">
      <% end %>
        <%= image_tag item.item_image_urls.first.url %>
        <div class="carousel-caption">
          <p>
            <%= item.name %>
            Current Item Rating:
            <span id="<%= item.id %>">
              <%= item.rating %>
            </span>
            <%= form_tag("/rate_item", method: "post", id: "#{item.id}", class: "form") do %>
              <%= label_tag(:rating, "Rating (0-5):") %>
              <%= text_field_tag(:rating) %>
              <%= hidden_field_tag(:item_id, item.id) %>
              <%= submit_tag("Rate Item") %>
            <% end %>
          </p>
        </div>
      </div>
    <% end %>
  </div>
  <a class="carousel-control left" href="#this-carousel-id" data-slide="prev">&lsaquo;</a>
  <a class="carousel-control right" href="#this-carousel-id" data-slide="next">&rsaquo;</a>
</div>

<script>
  $(document).ready(function(){
    $('.carousel').carousel({
      interval: 999999999
    });
  });
</script>

<script type="text/javascript">
  $(document).ready(function(){
    $(".form").submit(function(event){
      event.preventDefault();
      var valuesToSubmit = $(this).serialize();
      $.ajax({
        url: $(this).attr('action'),
        data: valuesToSubmit,
        dataType: "JSON"
      }).success(function(json){});

      var id = $(this).attr('id');
      $.ajax({
        url: '/item_rating.json',
        data: {'id': id},
        dataType: 'JSON'
      }).success(function(json){
        $("#" + id).text(json);
      });
    });
  });
</script>
